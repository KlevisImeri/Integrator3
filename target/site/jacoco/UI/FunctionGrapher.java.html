<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FunctionGrapher.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Klevis Report</a> &gt; <a href="index.source.html" class="el_package">UI</a> &gt; <span class="el_source">FunctionGrapher.java</span></div><h1>FunctionGrapher.java</h1><pre class="source lang-java linenums">package UI;

import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import data.Expression;
import data.Controller;

public class FunctionGrapher extends JPanel {
    private Controller controller;
<span class="nc" id="L11">    private static Color darkmodeBackgroundColor = new Color(24, 25, 26);</span>

<span class="nc" id="L13">    private int SCALE = 100;</span>
<span class="nc" id="L14">    private int divisionsSize = 5;</span>
    private int numberOfXdivisions;
    private int numberOfYdivisions;
<span class="nc" id="L17">    private int offsetX = 0;</span>
<span class="nc" id="L18">    private int offsetY = 0;</span>
<span class="nc" id="L19">    private int lastX = 0;</span>
<span class="nc" id="L20">    private int lastY = 0;</span>
    private int middleX;
    private int middleY;

<span class="nc" id="L24">    public FunctionGrapher(Controller controller) {</span>
<span class="nc" id="L25">        setBackground(darkmodeBackgroundColor);</span>
<span class="nc" id="L26">        setListeners();</span>
<span class="nc" id="L27">        this.controller = controller;</span>
<span class="nc" id="L28">    }</span>

    // Listeners of the cartesian plane
    private void addZoomListener() {
<span class="nc" id="L32">        this.addMouseWheelListener(new MouseWheelListener() {</span>
            @Override
            public void mouseWheelMoved(MouseWheelEvent e) {
<span class="nc" id="L35">                int notches = e.getWheelRotation();</span>
<span class="nc bnc" id="L36" title="All 2 branches missed.">                if (notches &lt; 0) {</span>
                    // Zoom in
<span class="nc" id="L38">                    SCALE += 10;</span>
<span class="nc" id="L39">                } else {</span>
                    // Zoom out
<span class="nc" id="L41">                    SCALE = Math.max(10, SCALE - 10);</span>
                }
<span class="nc" id="L43">                repaint();</span>
<span class="nc" id="L44">            }</span>
        });
<span class="nc" id="L46">    }</span>

    private void addClickListener() {
<span class="nc" id="L49">        addMouseListener(new MouseAdapter() {</span>
            @Override
            public void mousePressed(MouseEvent e) {
<span class="nc bnc" id="L52" title="All 2 branches missed.">                if (SwingUtilities.isRightMouseButton(e)) {</span>
<span class="nc" id="L53">                    lastX = e.getX();</span>
<span class="nc" id="L54">                    lastY = e.getY();</span>
                }
<span class="nc" id="L56">            }</span>
        });
<span class="nc" id="L58">    }</span>

    private void addDragListener() {
<span class="nc" id="L61">        addMouseMotionListener(new MouseMotionAdapter() {</span>
            @Override
            public void mouseDragged(MouseEvent e) {
<span class="nc bnc" id="L64" title="All 2 branches missed.">                if (SwingUtilities.isRightMouseButton(e)) {</span>
<span class="nc" id="L65">                    int dx = e.getX() - lastX;</span>
<span class="nc" id="L66">                    int dy = e.getY() - lastY;</span>
<span class="nc" id="L67">                    lastX = e.getX();</span>
<span class="nc" id="L68">                    lastY = e.getY();</span>
<span class="nc" id="L69">                    offsetX += dx;</span>
<span class="nc" id="L70">                    offsetY += dy;</span>
<span class="nc" id="L71">                    repaint();</span>
                }
<span class="nc" id="L73">            }</span>
        });
<span class="nc" id="L75">    }</span>

    private void addResizeListener() {
<span class="nc" id="L78">        addComponentListener(new ComponentAdapter() {</span>
            @Override
            public void componentResized(ComponentEvent e) {
<span class="nc" id="L81">                repaint();</span>
<span class="nc" id="L82">            }</span>
        });
<span class="nc" id="L84">    }</span>

    private void setListeners() {
<span class="nc" id="L87">        addZoomListener();</span>
<span class="nc" id="L88">        addClickListener();</span>
<span class="nc" id="L89">        addDragListener();</span>
<span class="nc" id="L90">        addResizeListener();</span>
<span class="nc" id="L91">    }</span>

    @Override
    protected void paintComponent(Graphics g) {
<span class="nc" id="L95">        setMiddleX();</span>
<span class="nc" id="L96">        setMiddleY();</span>
        // Should come after set middle
<span class="nc" id="L98">        setNumberOfXdivisions();</span>
<span class="nc" id="L99">        setNumberOfYdivisions();</span>

<span class="nc" id="L101">        super.paintComponent(g);</span>
<span class="nc" id="L102">        drawAxes(g);</span>

<span class="nc bnc" id="L104" title="All 2 branches missed.">        for (Expression function : controller.getFunctions()) {</span>
<span class="nc" id="L105">            drawFunction(g, function);</span>
        }

<span class="nc" id="L108">    }</span>

    private void drawAxes(Graphics g) {
<span class="nc" id="L111">        g.setColor(Color.WHITE);</span>

        // X-axis
<span class="nc" id="L114">        g.drawLine(0, middleY, getWidth(), middleY);</span>
<span class="nc" id="L115">        g.drawString(&quot;X&quot;, getWidth() - 15, middleY + 15);</span>

        // Y-axis
<span class="nc" id="L118">        g.drawLine(middleX, 0, middleX, getHeight());</span>
<span class="nc" id="L119">        g.drawString(&quot;Y&quot;, middleX - 15, 15);</span>

        // Draw axis divisions
<span class="nc" id="L122">        drawAxisDivisions(g);</span>
<span class="nc" id="L123">    }</span>

    private void drawFunction(Graphics g, Expression function) {
<span class="nc" id="L126">        g.setColor(controller.getFunctionColor(function));</span>

<span class="nc" id="L128">        setMiddleX();</span>
<span class="nc" id="L129">        setMiddleY();</span>

<span class="nc" id="L131">        double pixelsPerUnit = 1.0 / SCALE;</span>

        try {
<span class="nc bnc" id="L134" title="All 2 branches missed.">            for (int i = 0; i &lt; getWidth(); i++) {</span>
<span class="nc" id="L135">                double x1 = (i - middleX) * pixelsPerUnit;</span>
<span class="nc" id="L136">                double x2 = (i + 1 - middleX) * pixelsPerUnit;</span>
<span class="nc" id="L137">                double y1 = controller.evaluateFuntion(function, x1);</span>
<span class="nc" id="L138">                double y2 = controller.evaluateFuntion(function, x2);</span>
                
<span class="nc bnc" id="L140" title="All 6 branches missed.">                if(Double.isNaN(y1) || y1==Double.NEGATIVE_INFINITY || y1==Double.POSITIVE_INFINITY ) continue;</span>
<span class="nc bnc" id="L141" title="All 6 branches missed.">                if(Double.isNaN(y2) || y2==Double.NEGATIVE_INFINITY || y2==Double.POSITIVE_INFINITY ) continue;</span>

<span class="nc" id="L143">                int screenX1 = i;</span>
<span class="nc" id="L144">                int screenY1 = middleY - (int) (y1 * SCALE);</span>
<span class="nc" id="L145">                int screenX2 = i + 1;</span>
<span class="nc" id="L146">                int screenY2 = middleY - (int) (y2 * SCALE);</span>

<span class="nc" id="L148">                g.drawLine(screenX1, screenY1, screenX2, screenY2);</span>
<span class="nc" id="L149">                g.drawLine(screenX1, screenY1 + 1, screenX2, screenY2 + 1);</span>
<span class="nc" id="L150">                g.drawLine(screenX1, screenY1 - 1, screenX2, screenY2 - 1);</span>
            }
<span class="nc" id="L152">        } catch (Exception e) {</span>
        }
<span class="nc" id="L154">    }</span>

    private void drawAxisDivisions(Graphics g) {
<span class="nc" id="L157">        g.setColor(Color.WHITE);</span>

<span class="nc" id="L159">        double increment = 100.0 / SCALE;</span>

        // X-axis positive divisions
<span class="nc bnc" id="L162" title="All 2 branches missed.">        for (double i = 0; i &lt; numberOfXdivisions; i += increment) {</span>
<span class="nc" id="L163">            int x = middleX + (int) (i * SCALE);</span>

<span class="nc" id="L165">            g.drawLine(x, middleY - divisionsSize, x, middleY + divisionsSize);</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">            if (i != 0) {</span>
<span class="nc" id="L167">                g.drawString(String.format(&quot;%.2f&quot;, i), x - 15, middleY + 20);</span>
            }
        }

        // X-axis negative divisions
<span class="nc bnc" id="L172" title="All 2 branches missed.">        for (double i = 0; i &gt; -numberOfXdivisions; i -= increment) {</span>
<span class="nc" id="L173">            int x = middleX + (int) (i * SCALE);</span>

<span class="nc" id="L175">            g.drawLine(x, middleY - divisionsSize, x, middleY + divisionsSize);</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">            if (i != 0) {</span>
<span class="nc" id="L177">                g.drawString(String.format(&quot;%.2f&quot;, i), x - 15, middleY + 20);</span>
            }
        }

        // Y-axis negative divisions
<span class="nc bnc" id="L182" title="All 2 branches missed.">        for (double i = 0; i &lt; numberOfYdivisions; i += increment) {</span>
<span class="nc" id="L183">            int y = middleY + (int) (i * SCALE);</span>

<span class="nc" id="L185">            g.drawLine(middleX - divisionsSize, y, middleX + divisionsSize, y);</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">            if (i != 0) {</span>
<span class="nc" id="L187">                g.drawString(String.format(&quot;%.2f&quot;, -i), middleX - 30, y + 5);</span>
            }
        }

        // Y-axis positive divisions
<span class="nc bnc" id="L192" title="All 2 branches missed.">        for (double i = 0; i &gt; -numberOfYdivisions; i -= increment) {</span>
<span class="nc" id="L193">            int y = middleY + (int) (i * SCALE);</span>

<span class="nc" id="L195">            g.drawLine(middleX - divisionsSize, y, middleX + divisionsSize, y);</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">            if (i != 0) {</span>
<span class="nc" id="L197">                g.drawString(String.format(&quot;%.2f&quot;, -i), middleX - 30, y + 5);</span>
            }
        }
<span class="nc" id="L200">    }</span>

    public void setNumberOfXdivisions() {
<span class="nc" id="L203">        int positiveSide = (getWidth() - middleX) / SCALE;</span>
<span class="nc" id="L204">        int negativeSide = middleX / SCALE;</span>
<span class="nc" id="L205">        this.numberOfXdivisions = Math.max(positiveSide, negativeSide) + 1;</span>
<span class="nc" id="L206">    }</span>

    public void setNumberOfYdivisions() {
<span class="nc" id="L209">        int negativeSide = (getHeight() - middleY) / SCALE + 1;</span>
<span class="nc" id="L210">        int positiveSide = middleY / SCALE;</span>
<span class="nc" id="L211">        this.numberOfYdivisions = Math.max(positiveSide, negativeSide) + 1;</span>
<span class="nc" id="L212">    }</span>

    public void setMiddleX() {
<span class="nc" id="L215">        this.middleX = getWidth() / 2 + offsetX;</span>
<span class="nc" id="L216">    }</span>

    public void setMiddleY() {
<span class="nc" id="L219">        this.middleY = getHeight() / 2 + offsetY;</span>
<span class="nc" id="L220">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>